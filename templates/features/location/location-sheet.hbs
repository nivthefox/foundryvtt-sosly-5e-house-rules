<form class="{{#if editable}}editable{{else}}interactable{{/if}} tab-inventory" autocomplete="off">
    {{!-- Sheet Header --}}
    <header class="sheet-header">
        <div class="left">
            <div class="portrait">
                <img src="{{actor.img}}" alt="{{actor.name}}" data-tooltip="{{actor.name}}" data-action="editImage" data-edit="img">
            </div>
        </div>

        <div class="right stats">
            <div class="top">
                <div class="left">
                    {{#if editable}}
                        <input type="text" name="name" class="document-name uninput" value="{{actor.name}}">
                    {{else}}
                        <div class="document-name">{{actor.name}}</div>
                    {{/if}}

                    <ul class="labels unlist">
                        <li class="creature-type">
                            <span>Location</span>
                        </li>
                    </ul>
                </div>

                <div class="right">
                    {{!-- Future: Could add location-specific controls here --}}
                </div>
            </div>

            <div class="bottom">
                {{!-- Future: Could add location stats or summary info here --}}
            </div>
        </div>
    </header>

    {{!-- Sheet Body --}}
    <section class="sheet-body">
        
        <div class="main-content">
            
            <section class="tab-body">
                {{!-- Inventory Tab --}}
                <div class="tab inventory active" data-tab="inventory" data-group="primary">
                    <div class="inventory-element" v2="">

                    <section class="currency">
                        <button type="button" class="item-action unbutton" data-action="currency" data-tooltip="DND5E.CurrencyManager.Title" aria-label="Manage Currency">
                            <i class="fas fa-coins"></i>
                        </button>
                        {{#each currencyLabels as |label denomination|}}
                        <label aria-label="{{label}}">
                            <i class="currency {{denomination}}" data-tooltip="{{label}}"></i>
                            <input type="text" class="uninput" name="system.currency.{{denomination}}" value="{{lookup @root.system.currency denomination}}" data-dtype="Number" inputmode="numeric" pattern="[0-9+=\-]*">
                        </label>
                        {{/each}}
                    </section>

                    <div class="middle">
                        <div class="item-list-controls-placeholder" data-for="inventory"></div>
                    </div>

                    <section class="items-list inventory-list" data-item-list="inventory">
                        {{#each inventory as |section|}}
                        {{#if (or section.items.length (eq section.dataset.type "all"))}}
                        <div class="items-section card" data-type="{{section.dataset.type}}">
                            <div class="items-header header">
                                <h3 class="item-name">{{localize section.label}}</h3>
                                {{#if (eq section.dataset.type "container")}}
                                <div class="item-header item-capacity">Capacity</div>
                                {{else}}
                                <div class="item-header item-price">Price</div>
                                <div class="item-header item-weight">Weight</div>
                                <div class="item-header item-quantity">Quantity</div>
                                <div class="item-header item-uses">Charges</div>
                                {{/if}}
                                <div class="item-header item-controls"></div>
                            </div>

                            <ol class="item-list unlist">
                                {{#each section.items as |item|}}
                                <li class="item collapsible collapsed" data-item-id="{{item.id}}" data-entry-id="{{item.id}}" data-item-name="{{item.name}}" data-item-sort="{{item.sort}}" data-ungrouped="all" data-grouped="{{../dataset.type}}" data-uuid="Actor.{{../../../actor._id}}.Item.{{item.id}}">
                                    <div class="item-row" draggable="true">
                                        <div class="item-name item-action item-tooltip rollable" role="button" data-action="use" aria-label="{{item.name}}" data-tooltip-class="dnd5e2 dnd5e-tooltip item-tooltip" data-tooltip-direction="LEFT">
                                            <img class="item-image gold-icon" src="{{item.img}}" alt="{{item.name}}" draggable="false">
                                            <div class="name name-stacked">
                                                <span class="title">{{item.name}}</span>
                                                {{#if item.labels.subtitle}}
                                                <span class="subtitle">{{item.labels.subtitle}}</span>
                                                {{/if}}
                                            </div>
                                            <div class="tags"></div>
                                        </div>

                                        {{#if (eq item.type "container")}}
                                        <div class="item-detail item-capacity">
                                            {{#if item.capacity}}
                                            <div class="meter progress" role="meter" aria-valuemin="0" aria-valuenow="{{item.capacity.pct}}"
                                                 aria-valuetext="{{item.capacity.value}}" aria-valuemax="{{item.capacity.max}}"
                                                 style="--bar-percentage: {{item.capacity.pct}}%">
                                                <div class="label">
                                                    <i class="fas fa-weight-hanging"></i>
                                                    <span class="value">{{item.capacity.value}}</span>
                                                    <span class="separator">&sol;</span>
                                                    <span class="max">{{item.capacity.max}}</span>
                                                </div>
                                            </div>
                                            {{/if}}
                                        </div>
                                        {{else}}
                                        <div class="item-detail item-price {{#unless item.system.price.value}}empty{{/unless}}">
                                            {{#if item.system.price.value}}
                                            {{item.system.price.value}}
                                            <i class="currency {{item.system.price.denomination}}"></i>
                                            {{/if}}
                                        </div>

                                        <div class="item-detail item-weight {{#unless item.system.weight.value}}empty{{/unless}}">
                                            {{#if item.system.weight.value}}
                                            <i class="fas fa-weight-hanging"></i> {{item.system.weight.value}} {{item.system.weight.units}}
                                            {{/if}}
                                        </div>

                                        <div class="item-detail item-quantity">
                                            {{#if @root.editable}}
                                            <a class="adjustment-button" data-action="decrease" data-property="system.quantity">
                                                <i class="fas fa-minus"></i>
                                            </a>
                                            <input type="text" value="{{item.quantity}}" placeholder="0" data-dtype="Number" data-name="system.quantity" inputmode="numeric" pattern="[0-9+=\-]*" min="0">
                                            <a class="adjustment-button" data-action="increase" data-property="system.quantity">
                                                <i class="fas fa-plus"></i>
                                            </a>
                                            {{else}}
                                            {{item.quantity}}
                                            {{/if}}
                                        </div>

                                        <div class="item-detail item-uses {{#unless item.hasUses}}empty{{/unless}}">
                                            {{#if item.hasUses}}
                                            {{item.uses.value}}/{{item.uses.max}}
                                            {{/if}}
                                        </div>
                                        {{/if}}

                                        <div class="item-detail item-controls">
                                            {{#if @root.editable}}
                                            <a class="item-control interface-only" data-action="editItem" data-tooltip="DND5E.ItemEdit" aria-label="Edit Item">
                                                <i class="fas fa-edit"></i>
                                            </a>

                                            <a class="item-control item-action" data-action="deleteItem" data-tooltip="DND5E.ItemDelete" aria-label="Delete Item">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                            {{/if}}

                                            <a class="item-control interface-only" data-toggle-description="" aria-label="Toggle Description">
                                                <i class="fas fa-expand"></i>
                                            </a>

                                            <a class="item-control interface-only" data-context-menu="" aria-label="Additional Controls">
                                                <i class="fas fa-ellipsis-vertical"></i>
                                            </a>
                                        </div>
                                    </div>

                                    <div class="item-description collapsible-content">
                                        <div class="wrapper"></div>
                                    </div>
                                </li>
                                {{/each}}
                            </ol>
                        </div>
                        {{else}}
                        <div class="items-section card" data-type="{{section.dataset.type}}" {{#unless (eq section.dataset.type "all")}}hidden=""{{/unless}}>
                            <div class="items-header header">
                                <h3 class="item-name">{{localize section.label}}</h3>
                                <div class="item-header item-price">Price</div>
                                <div class="item-header item-weight">Weight</div>
                                <div class="item-header item-quantity">Quantity</div>
                                <div class="item-header item-uses">Charges</div>
                                <div class="item-header item-controls"></div>
                            </div>
                            <ol class="item-list unlist"></ol>
                        </div>
                        {{/if}}
                        {{/each}}
                    </section>

                    <div class="bottom">
                        <button type="button" class="create-child gold-button" aria-label="Create Item" {{#if (eq owner true)}}{{else}}disabled=""{{/if}}>
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>

                    </div>
                </div>

                {{!-- Features Tab --}}
        <div class="tab features" data-tab="features" data-group="primary">
            <div class="features-section">
                <h4>{{localize 'sosly.location.tabs.features'}}</h4>
                <ol class="features-list">
                    {{#each features as |item|}}
                    <li class="item" data-item-id="{{item.id}}">
                        <div class="item-image">
                            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                        </div>
                        <h4 class="item-name">{{item.name}}</h4>
                        <div class="item-controls">
                            {{#if item.hasUses}}
                            <span class="item-uses">{{item.uses.value}}/{{item.uses.max}}</span>
                            {{/if}}
                            <a class="item-control item-roll" title="{{localize 'DND5E.ItemRoll'}}" data-action="rollItem">
                                <i class="fas fa-dice-d20"></i>
                            </a>
                            <a class="item-control item-edit" title="{{localize 'DND5E.ItemEdit'}}" data-action="editItem">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a class="item-control item-delete" title="{{localize 'DND5E.ItemDelete'}}" data-action="deleteItem">
                                <i class="fas fa-trash"></i>
                            </a>
                        </div>
                    </li>
                    {{else}}
                    <li class="item empty">
                        <span class="empty-note">{{localize 'sosly.location.features.empty'}}</span>
                    </li>
                    {{/each}}
                </ol>
            </div>
        </div>


        {{!-- Details Tab --}}
        <div class="tab details" data-tab="details" data-group="primary">
            <div class="details-section">
                <h4>{{localize 'sosly.location.tabs.details'}}</h4>
                
                {{!-- Location Properties --}}
                <div class="location-properties">
                    <div class="form-group">
                        <label>{{localize 'sosly.location.parentLocation'}}</label>
                        {{#if editable}}
                            <input name="system.location" type="text" value="{{system.location}}" placeholder="{{localize 'sosly.location.parentLocationPlaceholder'}}" />
                        {{else}}
                            <span class="value">{{system.location}}</span>
                        {{/if}}
                    </div>
                    
                    <div class="form-group">
                        <label>{{localize 'sosly.location.locationType.label'}}</label>
                        {{#if editable}}
                            <select name="system.details.type">
                                {{#each typeChoices}}
                                <option value="{{value}}" {{#if selected}}selected{{/if}}>{{label}}</option>
                                {{/each}}
                            </select>
                        {{else}}
                            <span class="value">{{#each typeChoices}}{{#if selected}}{{label}}{{/if}}{{/each}}</span>
                        {{/if}}
                    </div>
                </div>
                
                {{!-- Description Editor --}}
                <div class="editor">
                    {{editor enrichedDescription target="system.details.description" button=true owner=owner editable=editable}}
                </div>
            </div>
        </div>
            </section>
        </div>
    </section>
</form>

{{!-- Sheet Navigation --}}
<nav class="tabs tabs-right" data-group="primary">
    <a class="item control active" data-group="primary" data-tab="inventory" data-tooltip="{{localize 'sosly.location.tabs.inventory'}}" aria-label="{{localize 'sosly.location.tabs.inventory'}}">
        <dnd5e-icon src="systems/dnd5e/icons/svg/backpack.svg"></dnd5e-icon>
    </a>
    <a class="item control" data-group="primary" data-tab="features" data-tooltip="{{localize 'sosly.location.tabs.features'}}" aria-label="{{localize 'sosly.location.tabs.features'}}">
        <i class="fas fa-list"></i>
    </a>
    <a class="item control" data-group="primary" data-tab="details" data-tooltip="{{localize 'sosly.location.tabs.details'}}" aria-label="{{localize 'sosly.location.tabs.details'}}">
        <i class="fas fa-feather"></i>
    </a>
</nav>